#include "hufstr.h"
#include <algorithm>
#include <iterator>

struct bitwriter {

	uint32_t buffer_ = 0;
	uint8_t nbits_ = 0;
	std::ostream& os_;

	bitwriter(std::ostream& os) : os_(os) { }
	~bitwriter() { flush(); }

	void write_bit(int bit) {
		buffer_ = (buffer_ << 1) | bit;
		++nbits_;
		if (nbits_ == 8) {
			os_.write(reinterpret_cast<char*>(&buffer_), 1);
			nbits_ = 0;
		}
	}

	std::ostream& write(uint32_t u, uint8_t n) {
		while (n-- > 0) {
			uint8_t bit = (u >> n) & 1;
			write_bit(bit);
		}
		return os_;
	}

	void flush(uint8_t bit = 1) { // 1 padding
		while (nbits_ > 0) {
			write_bit(bit);
		}
	}
};

struct bitreader {
	uint32_t buffer_ = 0;
	uint32_t nbits_ = 0;
	std::istream& is_;

	bitreader(std::istream& is) : is_(is) {}

	int read_bit() {
		if (nbits_ == 0) {
			if (!is_.read(reinterpret_cast<char*>(&buffer_), 1))
				return EOF;
			nbits_ = 8;
		}
		--nbits_;
		return (buffer_ >> nbits_) & 1;
	}

	explicit operator bool() { return bool(is_); }
	bool operator!() { return !is_; }

	std::istream& read(uint32_t& u, uint8_t n) {
		u = 0;
		while (n-- > 0) {
			u = (u << 1) | read_bit();
		}
		return is_;
	}
};

uint8_t hufstr::getSym(uint32_t code) const {
	for (auto& entry : _table) {
		if (entry.second._code == code)
			return entry.first;
	}
	return 0;
}

elem hufstr::getEntry(uint32_t code) const {
	for (auto& entry : _table) {
		if (entry.second._code == code)
			return entry.second;
	}
	elem empty;
	empty._code = 0;
	empty._len = 0;
	return empty;
}

hufstr::hufstr() {
	/*
	std::ifstream is("table.bin", std::ios::binary);
	uint8_t sym;
	elem elemRead;
	while (is.read(reinterpret_cast<char*>(&sym), sizeof(sym))) {
		is.read(reinterpret_cast<char*>(&elemRead._len), sizeof(elemRead._len));
		is.read(reinterpret_cast<char*>(&elemRead._code), sizeof(elemRead._code));
		is.get();
		_table[sym] = elemRead;
		triplet t;
		t._sym = sym;
		t._len = elemRead._len;
		t._code = elemRead._code;
		_huff_table.push_back(t);
	}*/
	triplet t;
	_table[32]._len = 3;
	_table[32]._code = 0;
	t._sym = 32;
	t._len = 3;
	t._code = 0;
	_huff_table.push_back(t);
	_table[101]._len = 3;
	_table[101]._code = 1;
	t._sym = 101;
	t._len = 3;
	t._code = 1;
	_huff_table.push_back(t);
	_table[97]._len = 4;
	_table[97]._code = 4;
	t._sym = 97;
	t._len = 4;
	t._code = 4;
	_huff_table.push_back(t);
	_table[105]._len = 4;
	_table[105]._code = 5;
	t._sym = 105;
	t._len = 4;
	t._code = 5;
	_huff_table.push_back(t);
	_table[108]._len = 4;
	_table[108]._code = 6;
	t._sym = 108;
	t._len = 4;
	t._code = 6;
	_huff_table.push_back(t);
	_table[110]._len = 4;
	_table[110]._code = 7;
	t._sym = 110;
	t._len = 4;
	t._code = 7;
	_huff_table.push_back(t);
	_table[111]._len = 4;
	_table[111]._code = 8;
	t._sym = 111;
	t._len = 4;
	t._code = 8;
	_huff_table.push_back(t);
	_table[114]._len = 4;
	_table[114]._code = 9;
	t._sym = 114;
	t._len = 4;
	t._code = 9;
	_huff_table.push_back(t);
	_table[99]._len = 5;
	_table[99]._code = 20;
	t._sym = 99;
	t._len = 5;
	t._code = 20;
	_huff_table.push_back(t);
	_table[100]._len = 5;
	_table[100]._code = 21;
	t._sym = 100;
	t._len = 5;
	t._code = 21;
	_huff_table.push_back(t);
	_table[115]._len = 5;
	_table[115]._code = 22;
	t._sym = 115;
	t._len = 5;
	t._code = 22;
	_huff_table.push_back(t);
	_table[116]._len = 5;
	_table[116]._code = 23;
	t._sym = 116;
	t._len = 5;
	t._code = 23;
	_huff_table.push_back(t);
	_table[117]._len = 5;
	_table[117]._code = 24;
	t._sym = 117;
	t._len = 5;
	t._code = 24;
	_huff_table.push_back(t);
	_table[39]._len = 6;
	_table[39]._code = 50;
	t._sym = 39;
	t._len = 6;
	t._code = 50;
	_huff_table.push_back(t);
	_table[44]._len = 6;
	_table[44]._code = 51;
	t._sym = 44;
	t._len = 6;
	t._code = 51;
	_huff_table.push_back(t);
	_table[103]._len = 6;
	_table[103]._code = 52;
	t._sym = 103;
	t._len = 6;
	t._code = 52;
	_huff_table.push_back(t);
	_table[109]._len = 6;
	_table[109]._code = 53;
	t._sym = 109;
	t._len = 6;
	t._code = 53;
	_huff_table.push_back(t);
	_table[112]._len = 6;
	_table[112]._code = 54;
	t._sym = 112;
	t._len = 6;
	t._code = 54;
	_huff_table.push_back(t);
	_table[118]._len = 6;
	_table[118]._code = 55;
	t._sym = 118;
	t._len = 6;
	t._code = 55;
	_huff_table.push_back(t);
	_table[9]._len = 7;
	_table[9]._code = 112;
	t._sym = 9;
	t._len = 7;
	t._code = 112;
	_huff_table.push_back(t);
	_table[10]._len = 7;
	_table[10]._code = 113;
	t._sym = 10;
	t._len = 7;
	t._code = 113;
	_huff_table.push_back(t);
	_table[13]._len = 7;
	_table[13]._code = 114;
	t._sym = 13;
	t._len = 7;
	t._code = 114;
	_huff_table.push_back(t);
	_table[46]._len = 7;
	_table[46]._code = 115;
	t._sym = 46;
	t._len = 7;
	t._code = 115;
	_huff_table.push_back(t);
	_table[91]._len = 7;
	_table[91]._code = 116;
	t._sym = 91;
	t._len = 7;
	t._code = 116;
	_huff_table.push_back(t);
	_table[93]._len = 7;
	_table[93]._code = 117;
	t._sym = 93;
	t._len = 7;
	t._code = 117;
	_huff_table.push_back(t);
	_table[98]._len = 7;
	_table[98]._code = 118;
	t._sym = 98;
	t._len = 7;
	t._code = 118;
	_huff_table.push_back(t);
	_table[102]._len = 7;
	_table[102]._code = 119;
	t._sym = 102;
	t._len = 7;
	t._code = 119;
	_huff_table.push_back(t);
	_table[104]._len = 7;
	_table[104]._code = 120;
	t._sym = 104;
	t._len = 7;
	t._code = 120;
	_huff_table.push_back(t);
	_table[34]._len = 8;
	_table[34]._code = 242;
	t._sym = 34;
	t._len = 8;
	t._code = 242;
	_huff_table.push_back(t);
	_table[49]._len = 8;
	_table[49]._code = 243;
	t._sym = 49;
	t._len = 8;
	t._code = 243;
	_huff_table.push_back(t);
	_table[83]._len = 8;
	_table[83]._code = 244;
	t._sym = 83;
	t._len = 8;
	t._code = 244;
	_huff_table.push_back(t);
	_table[113]._len = 8;
	_table[113]._code = 245;
	t._sym = 113;
	t._len = 8;
	t._code = 245;
	_huff_table.push_back(t);
	_table[122]._len = 8;
	_table[122]._code = 246;
	t._sym = 122;
	t._len = 8;
	t._code = 246;
	_huff_table.push_back(t);
	_table[50]._len = 9;
	_table[50]._code = 494;
	t._sym = 50;
	t._len = 9;
	t._code = 494;
	_huff_table.push_back(t);
	_table[51]._len = 9;
	_table[51]._code = 495;
	t._sym = 51;
	t._len = 9;
	t._code = 495;
	_huff_table.push_back(t);
	_table[58]._len = 9;
	_table[58]._code = 496;
	t._sym = 58;
	t._len = 9;
	t._code = 496;
	_huff_table.push_back(t);
	_table[59]._len = 9;
	_table[59]._code = 497;
	t._sym = 59;
	t._len = 9;
	t._code = 497;
	_huff_table.push_back(t);
	_table[65]._len = 9;
	_table[65]._code = 498;
	t._sym = 65;
	t._len = 9;
	t._code = 498;
	_huff_table.push_back(t);
	_table[68]._len = 9;
	_table[68]._code = 499;
	t._sym = 68;
	t._len = 9;
	t._code = 499;
	_huff_table.push_back(t);
	_table[69]._len = 9;
	_table[69]._code = 500;
	t._sym = 69;
	t._len = 9;
	t._code = 500;
	_huff_table.push_back(t);
	_table[71]._len = 9;
	_table[71]._code = 501;
	t._sym = 71;
	t._len = 9;
	t._code = 501;
	_huff_table.push_back(t);
	_table[73]._len = 9;
	_table[73]._code = 502;
	t._sym = 73;
	t._len = 9;
	t._code = 502;
	_huff_table.push_back(t);
	_table[48]._len = 10;
	_table[48]._code = 1006;
	t._sym = 48;
	t._len = 10;
	t._code = 1006;
	_huff_table.push_back(t);
	_table[52]._len = 10;
	_table[52]._code = 1007;
	t._sym = 52;
	t._len = 10;
	t._code = 1007;
	_huff_table.push_back(t);
	_table[53]._len = 10;
	_table[53]._code = 1008;
	t._sym = 53;
	t._len = 10;
	t._code = 1008;
	_huff_table.push_back(t);
	_table[54]._len = 10;
	_table[54]._code = 1009;
	t._sym = 54;
	t._len = 10;
	t._code = 1009;
	_huff_table.push_back(t);
	_table[55]._len = 10;
	_table[55]._code = 1010;
	t._sym = 55;
	t._len = 10;
	t._code = 1010;
	_huff_table.push_back(t);
	_table[56]._len = 10;
	_table[56]._code = 1011;
	t._sym = 56;
	t._len = 10;
	t._code = 1011;
	_huff_table.push_back(t);
	_table[57]._len = 10;
	_table[57]._code = 1012;
	t._sym = 57;
	t._len = 10;
	t._code = 1012;
	_huff_table.push_back(t);
	_table[63]._len = 10;
	_table[63]._code = 1013;
	t._sym = 63;
	t._len = 10;
	t._code = 1013;
	_huff_table.push_back(t);
	_table[67]._len = 10;
	_table[67]._code = 1014;
	t._sym = 67;
	t._len = 10;
	t._code = 1014;
	_huff_table.push_back(t);
	_table[76]._len = 10;
	_table[76]._code = 1015;
	t._sym = 76;
	t._len = 10;
	t._code = 1015;
	_huff_table.push_back(t);
	_table[77]._len = 10;
	_table[77]._code = 1016;
	t._sym = 77;
	t._len = 10;
	t._code = 1016;
	_huff_table.push_back(t);
	_table[78]._len = 10;
	_table[78]._code = 1017;
	t._sym = 78;
	t._len = 10;
	t._code = 1017;
	_huff_table.push_back(t);
	_table[80]._len = 10;
	_table[80]._code = 1018;
	t._sym = 80;
	t._len = 10;
	t._code = 1018;
	_huff_table.push_back(t);
	_table[33]._len = 11;
	_table[33]._code = 2038;
	t._sym = 33;
	t._len = 11;
	t._code = 2038;
	_huff_table.push_back(t);
	_table[66]._len = 11;
	_table[66]._code = 2039;
	t._sym = 66;
	t._len = 11;
	t._code = 2039;
	_huff_table.push_back(t);
	_table[70]._len = 11;
	_table[70]._code = 2040;
	t._sym = 70;
	t._len = 11;
	t._code = 2040;
	_huff_table.push_back(t);
	_table[79]._len = 11;
	_table[79]._code = 2041;
	t._sym = 79;
	t._len = 11;
	t._code = 2041;
	_huff_table.push_back(t);
	_table[81]._len = 11;
	_table[81]._code = 2042;
	t._sym = 81;
	t._len = 11;
	t._code = 2042;
	_huff_table.push_back(t);
	_table[82]._len = 11;
	_table[82]._code = 2043;
	t._sym = 82;
	t._len = 11;
	t._code = 2043;
	_huff_table.push_back(t);
	_table[84]._len = 11;
	_table[84]._code = 2044;
	t._sym = 84;
	t._len = 11;
	t._code = 2044;
	_huff_table.push_back(t);
	_table[45]._len = 12;
	_table[45]._code = 4090;
	t._sym = 45;
	t._len = 12;
	t._code = 4090;
	_huff_table.push_back(t);
	_table[86]._len = 12;
	_table[86]._code = 4091;
	t._sym = 86;
	t._len = 12;
	t._code = 4091;
	_huff_table.push_back(t);
	_table[107]._len = 12;
	_table[107]._code = 4092;
	t._sym = 107;
	t._len = 12;
	t._code = 4092;
	_huff_table.push_back(t);
	_table[40]._len = 13;
	_table[40]._code = 8186;
	t._sym = 40;
	t._len = 13;
	t._code = 8186;
	_huff_table.push_back(t);
	_table[41]._len = 13;
	_table[41]._code = 8187;
	t._sym = 41;
	t._len = 13;
	t._code = 8187;
	_huff_table.push_back(t);
	_table[72]._len = 13;
	_table[72]._code = 8188;
	t._sym = 72;
	t._len = 13;
	t._code = 8188;
	_huff_table.push_back(t);
	_table[85]._len = 13;
	_table[85]._code = 8189;
	t._sym = 85;
	t._len = 13;
	t._code = 8189;
	_huff_table.push_back(t);
	_table[90]._len = 13;
	_table[90]._code = 8190;
	t._sym = 90;
	t._len = 13;
	t._code = 8190;
	_huff_table.push_back(t);
	_table[75]._len = 14;
	_table[75]._code = 16382;
	t._sym = 75;
	t._len = 14;
	t._code = 16382;
	_huff_table.push_back(t);
	_table[47]._len = 17;
	_table[47]._code = 131064;
	t._sym = 47;
	t._len = 17;
	t._code = 131064;
	_huff_table.push_back(t);
	_table[119]._len = 18;
	_table[119]._code = 262130;
	t._sym = 119;
	t._len = 18;
	t._code = 262130;
	_huff_table.push_back(t);
	_table[64]._len = 19;
	_table[64]._code = 524262;
	t._sym = 64;
	t._len = 19;
	t._code = 524262;
	_huff_table.push_back(t);
	_table[74]._len = 19;
	_table[74]._code = 524263;
	t._sym = 74;
	t._len = 19;
	t._code = 524263;
	_huff_table.push_back(t);
	_table[88]._len = 20;
	_table[88]._code = 1048528;
	t._sym = 88;
	t._len = 20;
	t._code = 1048528;
	_huff_table.push_back(t);
	_table[120]._len = 20;
	_table[120]._code = 1048529;
	t._sym = 120;
	t._len = 20;
	t._code = 1048529;
	_huff_table.push_back(t);
	_table[87]._len = 21;
	_table[87]._code = 2097060;
	t._sym = 87;
	t._len = 21;
	t._code = 2097060;
	_huff_table.push_back(t);
	_table[94]._len = 21;
	_table[94]._code = 2097061;
	t._sym = 94;
	t._len = 21;
	t._code = 2097061;
	_huff_table.push_back(t);
	_table[106]._len = 21;
	_table[106]._code = 2097062;
	t._sym = 106;
	t._len = 21;
	t._code = 2097062;
	_huff_table.push_back(t);
	_table[121]._len = 21;
	_table[121]._code = 2097063;
	t._sym = 121;
	t._len = 21;
	t._code = 2097063;
	_huff_table.push_back(t);
	_table[125]._len = 21;
	_table[125]._code = 2097064;
	t._sym = 125;
	t._len = 21;
	t._code = 2097064;
	_huff_table.push_back(t);
	_table[0]._len = 22;
	_table[0]._code = 4194130;
	t._sym = 0;
	t._len = 22;
	t._code = 4194130;
	_huff_table.push_back(t);
	_table[1]._len = 22;
	_table[1]._code = 4194131;
	t._sym = 1;
	t._len = 22;
	t._code = 4194131;
	_huff_table.push_back(t);
	_table[2]._len = 22;
	_table[2]._code = 4194132;
	t._sym = 2;
	t._len = 22;
	t._code = 4194132;
	_huff_table.push_back(t);
	_table[3]._len = 22;
	_table[3]._code = 4194133;
	t._sym = 3;
	t._len = 22;
	t._code = 4194133;
	_huff_table.push_back(t);
	_table[4]._len = 22;
	_table[4]._code = 4194134;
	t._sym = 4;
	t._len = 22;
	t._code = 4194134;
	_huff_table.push_back(t);
	_table[5]._len = 22;
	_table[5]._code = 4194135;
	t._sym = 5;
	t._len = 22;
	t._code = 4194135;
	_huff_table.push_back(t);
	_table[6]._len = 22;
	_table[6]._code = 4194136;
	t._sym = 6;
	t._len = 22;
	t._code = 4194136;
	_huff_table.push_back(t);
	_table[7]._len = 22;
	_table[7]._code = 4194137;
	t._sym = 7;
	t._len = 22;
	t._code = 4194137;
	_huff_table.push_back(t);
	_table[8]._len = 22;
	_table[8]._code = 4194138;
	t._sym = 8;
	t._len = 22;
	t._code = 4194138;
	_huff_table.push_back(t);
	_table[11]._len = 22;
	_table[11]._code = 4194139;
	t._sym = 11;
	t._len = 22;
	t._code = 4194139;
	_huff_table.push_back(t);
	_table[12]._len = 22;
	_table[12]._code = 4194140;
	t._sym = 12;
	t._len = 22;
	t._code = 4194140;
	_huff_table.push_back(t);
	_table[14]._len = 22;
	_table[14]._code = 4194141;
	t._sym = 14;
	t._len = 22;
	t._code = 4194141;
	_huff_table.push_back(t);
	_table[15]._len = 22;
	_table[15]._code = 4194142;
	t._sym = 15;
	t._len = 22;
	t._code = 4194142;
	_huff_table.push_back(t);
	_table[16]._len = 22;
	_table[16]._code = 4194143;
	t._sym = 16;
	t._len = 22;
	t._code = 4194143;
	_huff_table.push_back(t);
	_table[17]._len = 22;
	_table[17]._code = 4194144;
	t._sym = 17;
	t._len = 22;
	t._code = 4194144;
	_huff_table.push_back(t);
	_table[18]._len = 22;
	_table[18]._code = 4194145;
	t._sym = 18;
	t._len = 22;
	t._code = 4194145;
	_huff_table.push_back(t);
	_table[19]._len = 22;
	_table[19]._code = 4194146;
	t._sym = 19;
	t._len = 22;
	t._code = 4194146;
	_huff_table.push_back(t);
	_table[20]._len = 22;
	_table[20]._code = 4194147;
	t._sym = 20;
	t._len = 22;
	t._code = 4194147;
	_huff_table.push_back(t);
	_table[21]._len = 22;
	_table[21]._code = 4194148;
	t._sym = 21;
	t._len = 22;
	t._code = 4194148;
	_huff_table.push_back(t);
	_table[22]._len = 22;
	_table[22]._code = 4194149;
	t._sym = 22;
	t._len = 22;
	t._code = 4194149;
	_huff_table.push_back(t);
	_table[23]._len = 22;
	_table[23]._code = 4194150;
	t._sym = 23;
	t._len = 22;
	t._code = 4194150;
	_huff_table.push_back(t);
	_table[24]._len = 22;
	_table[24]._code = 4194151;
	t._sym = 24;
	t._len = 22;
	t._code = 4194151;
	_huff_table.push_back(t);
	_table[25]._len = 22;
	_table[25]._code = 4194152;
	t._sym = 25;
	t._len = 22;
	t._code = 4194152;
	_huff_table.push_back(t);
	_table[26]._len = 22;
	_table[26]._code = 4194153;
	t._sym = 26;
	t._len = 22;
	t._code = 4194153;
	_huff_table.push_back(t);
	_table[27]._len = 22;
	_table[27]._code = 4194154;
	t._sym = 27;
	t._len = 22;
	t._code = 4194154;
	_huff_table.push_back(t);
	_table[28]._len = 22;
	_table[28]._code = 4194155;
	t._sym = 28;
	t._len = 22;
	t._code = 4194155;
	_huff_table.push_back(t);
	_table[29]._len = 22;
	_table[29]._code = 4194156;
	t._sym = 29;
	t._len = 22;
	t._code = 4194156;
	_huff_table.push_back(t);
	_table[30]._len = 22;
	_table[30]._code = 4194157;
	t._sym = 30;
	t._len = 22;
	t._code = 4194157;
	_huff_table.push_back(t);
	_table[31]._len = 22;
	_table[31]._code = 4194158;
	t._sym = 31;
	t._len = 22;
	t._code = 4194158;
	_huff_table.push_back(t);
	_table[35]._len = 22;
	_table[35]._code = 4194159;
	t._sym = 35;
	t._len = 22;
	t._code = 4194159;
	_huff_table.push_back(t);
	_table[36]._len = 22;
	_table[36]._code = 4194160;
	t._sym = 36;
	t._len = 22;
	t._code = 4194160;
	_huff_table.push_back(t);
	_table[37]._len = 22;
	_table[37]._code = 4194161;
	t._sym = 37;
	t._len = 22;
	t._code = 4194161;
	_huff_table.push_back(t);
	_table[38]._len = 22;
	_table[38]._code = 4194162;
	t._sym = 38;
	t._len = 22;
	t._code = 4194162;
	_huff_table.push_back(t);
	_table[42]._len = 22;
	_table[42]._code = 4194163;
	t._sym = 42;
	t._len = 22;
	t._code = 4194163;
	_huff_table.push_back(t);
	_table[43]._len = 22;
	_table[43]._code = 4194164;
	t._sym = 43;
	t._len = 22;
	t._code = 4194164;
	_huff_table.push_back(t);
	_table[60]._len = 22;
	_table[60]._code = 4194165;
	t._sym = 60;
	t._len = 22;
	t._code = 4194165;
	_huff_table.push_back(t);
	_table[61]._len = 22;
	_table[61]._code = 4194166;
	t._sym = 61;
	t._len = 22;
	t._code = 4194166;
	_huff_table.push_back(t);
	_table[62]._len = 22;
	_table[62]._code = 4194167;
	t._sym = 62;
	t._len = 22;
	t._code = 4194167;
	_huff_table.push_back(t);
	_table[89]._len = 22;
	_table[89]._code = 4194168;
	t._sym = 89;
	t._len = 22;
	t._code = 4194168;
	_huff_table.push_back(t);
	_table[92]._len = 22;
	_table[92]._code = 4194169;
	t._sym = 92;
	t._len = 22;
	t._code = 4194169;
	_huff_table.push_back(t);
	_table[95]._len = 22;
	_table[95]._code = 4194170;
	t._sym = 95;
	t._len = 22;
	t._code = 4194170;
	_huff_table.push_back(t);
	_table[96]._len = 22;
	_table[96]._code = 4194171;
	t._sym = 96;
	t._len = 22;
	t._code = 4194171;
	_huff_table.push_back(t);
	_table[123]._len = 22;
	_table[123]._code = 4194172;
	t._sym = 123;
	t._len = 22;
	t._code = 4194172;
	_huff_table.push_back(t);
	_table[124]._len = 22;
	_table[124]._code = 4194173;
	t._sym = 124;
	t._len = 22;
	t._code = 4194173;
	_huff_table.push_back(t);
	_table[126]._len = 22;
	_table[126]._code = 4194174;
	t._sym = 126;
	t._len = 22;
	t._code = 4194174;
	_huff_table.push_back(t);
	_table[127]._len = 22;
	_table[127]._code = 4194175;
	t._sym = 127;
	t._len = 22;
	t._code = 4194175;
	_huff_table.push_back(t);
	_table[128]._len = 22;
	_table[128]._code = 4194176;
	t._sym = 128;
	t._len = 22;
	t._code = 4194176;
	_huff_table.push_back(t);
	_table[129]._len = 22;
	_table[129]._code = 4194177;
	t._sym = 129;
	t._len = 22;
	t._code = 4194177;
	_huff_table.push_back(t);
	_table[130]._len = 22;
	_table[130]._code = 4194178;
	t._sym = 130;
	t._len = 22;
	t._code = 4194178;
	_huff_table.push_back(t);
	_table[131]._len = 22;
	_table[131]._code = 4194179;
	t._sym = 131;
	t._len = 22;
	t._code = 4194179;
	_huff_table.push_back(t);
	_table[132]._len = 22;
	_table[132]._code = 4194180;
	t._sym = 132;
	t._len = 22;
	t._code = 4194180;
	_huff_table.push_back(t);
	_table[133]._len = 22;
	_table[133]._code = 4194181;
	t._sym = 133;
	t._len = 22;
	t._code = 4194181;
	_huff_table.push_back(t);
	_table[134]._len = 22;
	_table[134]._code = 4194182;
	t._sym = 134;
	t._len = 22;
	t._code = 4194182;
	_huff_table.push_back(t);
	_table[135]._len = 22;
	_table[135]._code = 4194183;
	t._sym = 135;
	t._len = 22;
	t._code = 4194183;
	_huff_table.push_back(t);
	_table[136]._len = 22;
	_table[136]._code = 4194184;
	t._sym = 136;
	t._len = 22;
	t._code = 4194184;
	_huff_table.push_back(t);
	_table[137]._len = 22;
	_table[137]._code = 4194185;
	t._sym = 137;
	t._len = 22;
	t._code = 4194185;
	_huff_table.push_back(t);
	_table[138]._len = 22;
	_table[138]._code = 4194186;
	t._sym = 138;
	t._len = 22;
	t._code = 4194186;
	_huff_table.push_back(t);
	_table[139]._len = 22;
	_table[139]._code = 4194187;
	t._sym = 139;
	t._len = 22;
	t._code = 4194187;
	_huff_table.push_back(t);
	_table[140]._len = 22;
	_table[140]._code = 4194188;
	t._sym = 140;
	t._len = 22;
	t._code = 4194188;
	_huff_table.push_back(t);
	_table[141]._len = 22;
	_table[141]._code = 4194189;
	t._sym = 141;
	t._len = 22;
	t._code = 4194189;
	_huff_table.push_back(t);
	_table[142]._len = 22;
	_table[142]._code = 4194190;
	t._sym = 142;
	t._len = 22;
	t._code = 4194190;
	_huff_table.push_back(t);
	_table[143]._len = 22;
	_table[143]._code = 4194191;
	t._sym = 143;
	t._len = 22;
	t._code = 4194191;
	_huff_table.push_back(t);
	_table[144]._len = 22;
	_table[144]._code = 4194192;
	t._sym = 144;
	t._len = 22;
	t._code = 4194192;
	_huff_table.push_back(t);
	_table[145]._len = 22;
	_table[145]._code = 4194193;
	t._sym = 145;
	t._len = 22;
	t._code = 4194193;
	_huff_table.push_back(t);
	_table[146]._len = 22;
	_table[146]._code = 4194194;
	t._sym = 146;
	t._len = 22;
	t._code = 4194194;
	_huff_table.push_back(t);
	_table[147]._len = 22;
	_table[147]._code = 4194195;
	t._sym = 147;
	t._len = 22;
	t._code = 4194195;
	_huff_table.push_back(t);
	_table[148]._len = 22;
	_table[148]._code = 4194196;
	t._sym = 148;
	t._len = 22;
	t._code = 4194196;
	_huff_table.push_back(t);
	_table[149]._len = 22;
	_table[149]._code = 4194197;
	t._sym = 149;
	t._len = 22;
	t._code = 4194197;
	_huff_table.push_back(t);
	_table[150]._len = 22;
	_table[150]._code = 4194198;
	t._sym = 150;
	t._len = 22;
	t._code = 4194198;
	_huff_table.push_back(t);
	_table[151]._len = 22;
	_table[151]._code = 4194199;
	t._sym = 151;
	t._len = 22;
	t._code = 4194199;
	_huff_table.push_back(t);
	_table[152]._len = 22;
	_table[152]._code = 4194200;
	t._sym = 152;
	t._len = 22;
	t._code = 4194200;
	_huff_table.push_back(t);
	_table[153]._len = 22;
	_table[153]._code = 4194201;
	t._sym = 153;
	t._len = 22;
	t._code = 4194201;
	_huff_table.push_back(t);
	_table[154]._len = 22;
	_table[154]._code = 4194202;
	t._sym = 154;
	t._len = 22;
	t._code = 4194202;
	_huff_table.push_back(t);
	_table[155]._len = 22;
	_table[155]._code = 4194203;
	t._sym = 155;
	t._len = 22;
	t._code = 4194203;
	_huff_table.push_back(t);
	_table[156]._len = 22;
	_table[156]._code = 4194204;
	t._sym = 156;
	t._len = 22;
	t._code = 4194204;
	_huff_table.push_back(t);
	_table[157]._len = 22;
	_table[157]._code = 4194205;
	t._sym = 157;
	t._len = 22;
	t._code = 4194205;
	_huff_table.push_back(t);
	_table[158]._len = 22;
	_table[158]._code = 4194206;
	t._sym = 158;
	t._len = 22;
	t._code = 4194206;
	_huff_table.push_back(t);
	_table[159]._len = 22;
	_table[159]._code = 4194207;
	t._sym = 159;
	t._len = 22;
	t._code = 4194207;
	_huff_table.push_back(t);
	_table[160]._len = 22;
	_table[160]._code = 4194208;
	t._sym = 160;
	t._len = 22;
	t._code = 4194208;
	_huff_table.push_back(t);
	_table[161]._len = 22;
	_table[161]._code = 4194209;
	t._sym = 161;
	t._len = 22;
	t._code = 4194209;
	_huff_table.push_back(t);
	_table[162]._len = 22;
	_table[162]._code = 4194210;
	t._sym = 162;
	t._len = 22;
	t._code = 4194210;
	_huff_table.push_back(t);
	_table[163]._len = 22;
	_table[163]._code = 4194211;
	t._sym = 163;
	t._len = 22;
	t._code = 4194211;
	_huff_table.push_back(t);
	_table[164]._len = 22;
	_table[164]._code = 4194212;
	t._sym = 164;
	t._len = 22;
	t._code = 4194212;
	_huff_table.push_back(t);
	_table[165]._len = 22;
	_table[165]._code = 4194213;
	t._sym = 165;
	t._len = 22;
	t._code = 4194213;
	_huff_table.push_back(t);
	_table[166]._len = 22;
	_table[166]._code = 4194214;
	t._sym = 166;
	t._len = 22;
	t._code = 4194214;
	_huff_table.push_back(t);
	_table[167]._len = 22;
	_table[167]._code = 4194215;
	t._sym = 167;
	t._len = 22;
	t._code = 4194215;
	_huff_table.push_back(t);
	_table[168]._len = 22;
	_table[168]._code = 4194216;
	t._sym = 168;
	t._len = 22;
	t._code = 4194216;
	_huff_table.push_back(t);
	_table[169]._len = 22;
	_table[169]._code = 4194217;
	t._sym = 169;
	t._len = 22;
	t._code = 4194217;
	_huff_table.push_back(t);
	_table[170]._len = 22;
	_table[170]._code = 4194218;
	t._sym = 170;
	t._len = 22;
	t._code = 4194218;
	_huff_table.push_back(t);
	_table[171]._len = 22;
	_table[171]._code = 4194219;
	t._sym = 171;
	t._len = 22;
	t._code = 4194219;
	_huff_table.push_back(t);
	_table[172]._len = 22;
	_table[172]._code = 4194220;
	t._sym = 172;
	t._len = 22;
	t._code = 4194220;
	_huff_table.push_back(t);
	_table[173]._len = 22;
	_table[173]._code = 4194221;
	t._sym = 173;
	t._len = 22;
	t._code = 4194221;
	_huff_table.push_back(t);
	_table[174]._len = 22;
	_table[174]._code = 4194222;
	t._sym = 174;
	t._len = 22;
	t._code = 4194222;
	_huff_table.push_back(t);
	_table[175]._len = 22;
	_table[175]._code = 4194223;
	t._sym = 175;
	t._len = 22;
	t._code = 4194223;
	_huff_table.push_back(t);
	_table[176]._len = 22;
	_table[176]._code = 4194224;
	t._sym = 176;
	t._len = 22;
	t._code = 4194224;
	_huff_table.push_back(t);
	_table[177]._len = 22;
	_table[177]._code = 4194225;
	t._sym = 177;
	t._len = 22;
	t._code = 4194225;
	_huff_table.push_back(t);
	_table[178]._len = 22;
	_table[178]._code = 4194226;
	t._sym = 178;
	t._len = 22;
	t._code = 4194226;
	_huff_table.push_back(t);
	_table[179]._len = 22;
	_table[179]._code = 4194227;
	t._sym = 179;
	t._len = 22;
	t._code = 4194227;
	_huff_table.push_back(t);
	_table[180]._len = 22;
	_table[180]._code = 4194228;
	t._sym = 180;
	t._len = 22;
	t._code = 4194228;
	_huff_table.push_back(t);
	_table[181]._len = 22;
	_table[181]._code = 4194229;
	t._sym = 181;
	t._len = 22;
	t._code = 4194229;
	_huff_table.push_back(t);
	_table[182]._len = 22;
	_table[182]._code = 4194230;
	t._sym = 182;
	t._len = 22;
	t._code = 4194230;
	_huff_table.push_back(t);
	_table[183]._len = 22;
	_table[183]._code = 4194231;
	t._sym = 183;
	t._len = 22;
	t._code = 4194231;
	_huff_table.push_back(t);
	_table[184]._len = 22;
	_table[184]._code = 4194232;
	t._sym = 184;
	t._len = 22;
	t._code = 4194232;
	_huff_table.push_back(t);
	_table[185]._len = 22;
	_table[185]._code = 4194233;
	t._sym = 185;
	t._len = 22;
	t._code = 4194233;
	_huff_table.push_back(t);
	_table[186]._len = 22;
	_table[186]._code = 4194234;
	t._sym = 186;
	t._len = 22;
	t._code = 4194234;
	_huff_table.push_back(t);
	_table[187]._len = 22;
	_table[187]._code = 4194235;
	t._sym = 187;
	t._len = 22;
	t._code = 4194235;
	_huff_table.push_back(t);
	_table[188]._len = 22;
	_table[188]._code = 4194236;
	t._sym = 188;
	t._len = 22;
	t._code = 4194236;
	_huff_table.push_back(t);
	_table[189]._len = 22;
	_table[189]._code = 4194237;
	t._sym = 189;
	t._len = 22;
	t._code = 4194237;
	_huff_table.push_back(t);
	_table[190]._len = 22;
	_table[190]._code = 4194238;
	t._sym = 190;
	t._len = 22;
	t._code = 4194238;
	_huff_table.push_back(t);
	_table[191]._len = 22;
	_table[191]._code = 4194239;
	t._sym = 191;
	t._len = 22;
	t._code = 4194239;
	_huff_table.push_back(t);
	_table[192]._len = 22;
	_table[192]._code = 4194240;
	t._sym = 192;
	t._len = 22;
	t._code = 4194240;
	_huff_table.push_back(t);
	_table[193]._len = 22;
	_table[193]._code = 4194241;
	t._sym = 193;
	t._len = 22;
	t._code = 4194241;
	_huff_table.push_back(t);
	_table[194]._len = 22;
	_table[194]._code = 4194242;
	t._sym = 194;
	t._len = 22;
	t._code = 4194242;
	_huff_table.push_back(t);
	_table[195]._len = 22;
	_table[195]._code = 4194243;
	t._sym = 195;
	t._len = 22;
	t._code = 4194243;
	_huff_table.push_back(t);
	_table[196]._len = 22;
	_table[196]._code = 4194244;
	t._sym = 196;
	t._len = 22;
	t._code = 4194244;
	_huff_table.push_back(t);
	_table[197]._len = 22;
	_table[197]._code = 4194245;
	t._sym = 197;
	t._len = 22;
	t._code = 4194245;
	_huff_table.push_back(t);
	_table[198]._len = 22;
	_table[198]._code = 4194246;
	t._sym = 198;
	t._len = 22;
	t._code = 4194246;
	_huff_table.push_back(t);
	_table[199]._len = 22;
	_table[199]._code = 4194247;
	t._sym = 199;
	t._len = 22;
	t._code = 4194247;
	_huff_table.push_back(t);
	_table[200]._len = 22;
	_table[200]._code = 4194248;
	t._sym = 200;
	t._len = 22;
	t._code = 4194248;
	_huff_table.push_back(t);
	_table[201]._len = 22;
	_table[201]._code = 4194249;
	t._sym = 201;
	t._len = 22;
	t._code = 4194249;
	_huff_table.push_back(t);
	_table[202]._len = 22;
	_table[202]._code = 4194250;
	t._sym = 202;
	t._len = 22;
	t._code = 4194250;
	_huff_table.push_back(t);
	_table[203]._len = 22;
	_table[203]._code = 4194251;
	t._sym = 203;
	t._len = 22;
	t._code = 4194251;
	_huff_table.push_back(t);
	_table[204]._len = 22;
	_table[204]._code = 4194252;
	t._sym = 204;
	t._len = 22;
	t._code = 4194252;
	_huff_table.push_back(t);
	_table[205]._len = 22;
	_table[205]._code = 4194253;
	t._sym = 205;
	t._len = 22;
	t._code = 4194253;
	_huff_table.push_back(t);
	_table[206]._len = 22;
	_table[206]._code = 4194254;
	t._sym = 206;
	t._len = 22;
	t._code = 4194254;
	_huff_table.push_back(t);
	_table[207]._len = 22;
	_table[207]._code = 4194255;
	t._sym = 207;
	t._len = 22;
	t._code = 4194255;
	_huff_table.push_back(t);
	_table[208]._len = 22;
	_table[208]._code = 4194256;
	t._sym = 208;
	t._len = 22;
	t._code = 4194256;
	_huff_table.push_back(t);
	_table[209]._len = 22;
	_table[209]._code = 4194257;
	t._sym = 209;
	t._len = 22;
	t._code = 4194257;
	_huff_table.push_back(t);
	_table[210]._len = 22;
	_table[210]._code = 4194258;
	t._sym = 210;
	t._len = 22;
	t._code = 4194258;
	_huff_table.push_back(t);
	_table[211]._len = 22;
	_table[211]._code = 4194259;
	t._sym = 211;
	t._len = 22;
	t._code = 4194259;
	_huff_table.push_back(t);
	_table[212]._len = 22;
	_table[212]._code = 4194260;
	t._sym = 212;
	t._len = 22;
	t._code = 4194260;
	_huff_table.push_back(t);
	_table[213]._len = 22;
	_table[213]._code = 4194261;
	t._sym = 213;
	t._len = 22;
	t._code = 4194261;
	_huff_table.push_back(t);
	_table[214]._len = 22;
	_table[214]._code = 4194262;
	t._sym = 214;
	t._len = 22;
	t._code = 4194262;
	_huff_table.push_back(t);
	_table[215]._len = 22;
	_table[215]._code = 4194263;
	t._sym = 215;
	t._len = 22;
	t._code = 4194263;
	_huff_table.push_back(t);
	_table[216]._len = 22;
	_table[216]._code = 4194264;
	t._sym = 216;
	t._len = 22;
	t._code = 4194264;
	_huff_table.push_back(t);
	_table[217]._len = 22;
	_table[217]._code = 4194265;
	t._sym = 217;
	t._len = 22;
	t._code = 4194265;
	_huff_table.push_back(t);
	_table[218]._len = 22;
	_table[218]._code = 4194266;
	t._sym = 218;
	t._len = 22;
	t._code = 4194266;
	_huff_table.push_back(t);
	_table[219]._len = 22;
	_table[219]._code = 4194267;
	t._sym = 219;
	t._len = 22;
	t._code = 4194267;
	_huff_table.push_back(t);
	_table[220]._len = 22;
	_table[220]._code = 4194268;
	t._sym = 220;
	t._len = 22;
	t._code = 4194268;
	_huff_table.push_back(t);
	_table[221]._len = 22;
	_table[221]._code = 4194269;
	t._sym = 221;
	t._len = 22;
	t._code = 4194269;
	_huff_table.push_back(t);
	_table[222]._len = 22;
	_table[222]._code = 4194270;
	t._sym = 222;
	t._len = 22;
	t._code = 4194270;
	_huff_table.push_back(t);
	_table[223]._len = 22;
	_table[223]._code = 4194271;
	t._sym = 223;
	t._len = 22;
	t._code = 4194271;
	_huff_table.push_back(t);
	_table[224]._len = 22;
	_table[224]._code = 4194272;
	t._sym = 224;
	t._len = 22;
	t._code = 4194272;
	_huff_table.push_back(t);
	_table[225]._len = 22;
	_table[225]._code = 4194273;
	t._sym = 225;
	t._len = 22;
	t._code = 4194273;
	_huff_table.push_back(t);
	_table[226]._len = 22;
	_table[226]._code = 4194274;
	t._sym = 226;
	t._len = 22;
	t._code = 4194274;
	_huff_table.push_back(t);
	_table[227]._len = 22;
	_table[227]._code = 4194275;
	t._sym = 227;
	t._len = 22;
	t._code = 4194275;
	_huff_table.push_back(t);
	_table[228]._len = 22;
	_table[228]._code = 4194276;
	t._sym = 228;
	t._len = 22;
	t._code = 4194276;
	_huff_table.push_back(t);
	_table[229]._len = 22;
	_table[229]._code = 4194277;
	t._sym = 229;
	t._len = 22;
	t._code = 4194277;
	_huff_table.push_back(t);
	_table[230]._len = 22;
	_table[230]._code = 4194278;
	t._sym = 230;
	t._len = 22;
	t._code = 4194278;
	_huff_table.push_back(t);
	_table[231]._len = 22;
	_table[231]._code = 4194279;
	t._sym = 231;
	t._len = 22;
	t._code = 4194279;
	_huff_table.push_back(t);
	_table[232]._len = 22;
	_table[232]._code = 4194280;
	t._sym = 232;
	t._len = 22;
	t._code = 4194280;
	_huff_table.push_back(t);
	_table[233]._len = 22;
	_table[233]._code = 4194281;
	t._sym = 233;
	t._len = 22;
	t._code = 4194281;
	_huff_table.push_back(t);
	_table[234]._len = 22;
	_table[234]._code = 4194282;
	t._sym = 234;
	t._len = 22;
	t._code = 4194282;
	_huff_table.push_back(t);
	_table[235]._len = 22;
	_table[235]._code = 4194283;
	t._sym = 235;
	t._len = 22;
	t._code = 4194283;
	_huff_table.push_back(t);
	_table[236]._len = 22;
	_table[236]._code = 4194284;
	t._sym = 236;
	t._len = 22;
	t._code = 4194284;
	_huff_table.push_back(t);
	_table[237]._len = 22;
	_table[237]._code = 4194285;
	t._sym = 237;
	t._len = 22;
	t._code = 4194285;
	_huff_table.push_back(t);
	_table[238]._len = 22;
	_table[238]._code = 4194286;
	t._sym = 238;
	t._len = 22;
	t._code = 4194286;
	_huff_table.push_back(t);
	_table[239]._len = 22;
	_table[239]._code = 4194287;
	t._sym = 239;
	t._len = 22;
	t._code = 4194287;
	_huff_table.push_back(t);
	_table[240]._len = 22;
	_table[240]._code = 4194288;
	t._sym = 240;
	t._len = 22;
	t._code = 4194288;
	_huff_table.push_back(t);
	_table[241]._len = 22;
	_table[241]._code = 4194289;
	t._sym = 241;
	t._len = 22;
	t._code = 4194289;
	_huff_table.push_back(t);
	_table[242]._len = 22;
	_table[242]._code = 4194290;
	t._sym = 242;
	t._len = 22;
	t._code = 4194290;
	_huff_table.push_back(t);
	_table[243]._len = 22;
	_table[243]._code = 4194291;
	t._sym = 243;
	t._len = 22;
	t._code = 4194291;
	_huff_table.push_back(t);
	_table[244]._len = 22;
	_table[244]._code = 4194292;
	t._sym = 244;
	t._len = 22;
	t._code = 4194292;
	_huff_table.push_back(t);
	_table[245]._len = 22;
	_table[245]._code = 4194293;
	t._sym = 245;
	t._len = 22;
	t._code = 4194293;
	_huff_table.push_back(t);
	_table[246]._len = 22;
	_table[246]._code = 4194294;
	t._sym = 246;
	t._len = 22;
	t._code = 4194294;
	_huff_table.push_back(t);
	_table[247]._len = 22;
	_table[247]._code = 4194295;
	t._sym = 247;
	t._len = 22;
	t._code = 4194295;
	_huff_table.push_back(t);
	_table[248]._len = 22;
	_table[248]._code = 4194296;
	t._sym = 248;
	t._len = 22;
	t._code = 4194296;
	_huff_table.push_back(t);
	_table[249]._len = 22;
	_table[249]._code = 4194297;
	t._sym = 249;
	t._len = 22;
	t._code = 4194297;
	_huff_table.push_back(t);
	_table[250]._len = 22;
	_table[250]._code = 4194298;
	t._sym = 250;
	t._len = 22;
	t._code = 4194298;
	_huff_table.push_back(t);
	_table[251]._len = 22;
	_table[251]._code = 4194299;
	t._sym = 251;
	t._len = 22;
	t._code = 4194299;
	_huff_table.push_back(t);
	_table[252]._len = 22;
	_table[252]._code = 4194300;
	t._sym = 252;
	t._len = 22;
	t._code = 4194300;
	_huff_table.push_back(t);
	_table[253]._len = 22;
	_table[253]._code = 4194301;
	t._sym = 253;
	t._len = 22;
	t._code = 4194301;
	_huff_table.push_back(t);
	_table[254]._len = 22;
	_table[254]._code = 4194302;
	t._sym = 254;
	t._len = 22;
	t._code = 4194302;
	_huff_table.push_back(t);
	_table[255]._len = 22;
	_table[255]._code = 4194303;
	t._sym = 255;
	t._len = 22;
	t._code = 4194303;
	_huff_table.push_back(t);

}

std::vector<uint8_t> hufstr::compress(const std::string& s) const {
	std::vector<uint8_t> compressed;
	std::stringstream stream;
	bitwriter bw(stream);
	for (auto carattere : s) { // Per ogni carattere nella stringa
		uint8_t sym = (uint8_t)carattere; // Estraggo il carattere
		bw.write(_table.at(sym)._code, _table.at(sym)._len); // e riporto il simbolo sullo stream con _len bit
	}
	bw.flush(1); // 1 padding
	uint8_t chunk;
	while (stream.read(reinterpret_cast<char*>(&chunk), 1)) {
		compressed.push_back(chunk);
	}
	return compressed;
}

std::string hufstr::decompress(const std::vector<uint8_t>& v) const {
	std::stringstream stream;
	for (auto chunk : v) { // Riporto ogni elemento del vettore sul file
		stream.write(reinterpret_cast<char*>(&chunk), 1);
	}
	bitreader br(stream);
	std::string decompressedOutput;
	uint8_t tmp;
	std::vector<triplet> huff_table = _huff_table;
	sort(huff_table.begin(), huff_table.end(),
		[](const triplet& lhs, const triplet& rhs) {
			return lhs._len < rhs._len;
		});
	while (stream.read(reinterpret_cast<char*>(&tmp), 1) || br.nbits_ != 0) {
		stream.seekg((size_t)stream.tellg() - 1);  // Resetto il puntatore
		uint32_t curlen = 0;
		uint32_t curcode = 0;
		size_t pos = 0;
		while (true) {
			auto cur_entry = huff_table[pos];
			while (curlen < cur_entry._len) {
				curcode = (curcode << 1) | br.read_bit();
				++curlen;
			}
			if (curcode == cur_entry._code) {
				decompressedOutput.push_back((char)cur_entry._sym);
				break;
			}
			++pos;
			if (pos >= huff_table.size()) {
				//error("Huffman code not found");
				break;
			}
		}
	}
	return decompressedOutput;
}
